<div class="rewrite-extension-settings">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Rewrite Extension</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">
            <div class="rewrite-extension_block flex-container">
                <label for="rewrite_extension_model_select">Configure Model:</label>
                <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Choose which Completion type to configure. For Chat Completion this affects if presets or templates are used."></span>
                <select id="rewrite_extension_model_select" class="text_pole">
                    <option value="chat_completion">Chat Completion</option>
                    <option value="textgenerationwebui">Text Completion/NovelAI</option>
                </select>
            </div>

            <div id="chat_completion_settings" class="model-specific-settings">
                <div class="rewrite-extension_block flex-container">
                    <label for="rewrite_preset">Rewrite Preset:</label>
                    <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="To use a simple 'System: prompt', switch to Text Completion. This will always use the preset's max tokens setting."></span>
                    <select id="rewrite_preset" class="text_pole" data-preset-manager-for="rewrite">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="shorten_preset">Shorten Preset:</label>
                    <select id="shorten_preset" class="text_pole" data-preset-manager-for="shorten">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="expand_preset">Expand Preset:</label>
                    <select id="expand_preset" class="text_pole" data-preset-manager-for="expand">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="custom_preset">Custom Preset:</label>
                    <select id="custom_preset" class="text_pole" data-preset-manager-for="custom">
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="rewrite-extension_block flex-container checkbox-container">
                    <div class="checkbox-label-group">
                        <input type="checkbox" id="override_max_tokens" class="checkbox" checked>
                        <label for="override_max_tokens">Override Preset Max Tokens</label>
                    </div>
                    <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="If checked, the extension will override the max tokens set in the chat completion preset."></span>
                </div>
            </div>

            <div id="text_based_settings" class="model-specific-settings" style="display: none;">
                <div class="rewrite-extension_block flex-container">
                    <label for="text_rewrite_prompt">Rewrite Prompt:</label>
                    <textarea id="text_rewrite_prompt" class="text_pole" rows="3" placeholder="Enter rewrite prompt"></textarea>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="text_shorten_prompt">Shorten Prompt:</label>
                    <textarea id="text_shorten_prompt" class="text_pole" rows="3" placeholder="Enter shorten prompt"></textarea>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="text_expand_prompt">Expand Prompt:</label>
                    <textarea id="text_expand_prompt" class="text_pole" rows="3" placeholder="Enter expand prompt"></textarea>
                </div>

                <div class="rewrite-extension_block flex-container">
                    <label for="text_custom_prompt">Custom Prompt:</label>
                    <textarea id="text_custom_prompt" class="text_pole" rows="3" placeholder="Enter custom prompt. Use {{custom_instructions}} macro."></textarea>
                </div>
            </div>

            <hr class="sysHR" />

            <!-- Universal settings -->
            <div class="rewrite-extension_block flex-container checkbox-container">
                <div class="checkbox-label-group">
                    <input type="checkbox" id="use_streaming" class="checkbox">
                    <label for="use_streaming">Use Streaming</label>
                </div>
                <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Enable to see the rewritten text appear gradually. Might not work for all APIs."></span>
            </div>

            <div class="rewrite-extension_block flex-container checkbox-container">
                <div class="checkbox-label-group">
                    <input type="checkbox" id="apply_regex_on_rewrite" class="checkbox">
                    <label for="apply_regex_on_rewrite">Apply Regex on Rewrite</label>
                </div>
                <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="If checked, applies configured AI Output regex scripts to the rewritten text."></span>
            </div>

            <div class="rewrite-extension_block flex-container checkbox-container">
                <div class="checkbox-label-group">
                    <input type="checkbox" id="use_dynamic_tokens" class="checkbox">
                    <label for="use_dynamic_tokens">Use Dynamic Token Calculation</label>
                </div>
                <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Adjust token count based on the length of the selected text."></span>
            </div>

            <!-- Token settings -->
            <div id="static_token_settings">
                <div class="rewrite-extension_block flex-container">
                    <label for="rewrite_tokens">Rewrite Tokens:</label>
                    <input type="number" id="rewrite_tokens" class="text_pole" min="0" value="100">
                </div>
                <div class="rewrite-extension_block flex-container">
                    <label for="shorten_tokens">Shorten Tokens:</label>
                    <input type="number" id="shorten_tokens" class="text_pole" min="0" value="50">
                </div>
                <div class="rewrite-extension_block flex-container">
                    <label for="expand_tokens">Expand Tokens:</label>
                    <input type="number" id="expand_tokens" class="text_pole" min="0" value="150">
                </div>
                <div class="rewrite-extension_block flex-container">
                    <label for="custom_tokens">Custom Tokens:</label>
                    <input type="number" id="custom_tokens" class="text_pole" min="0" value="100">
                </div>
            </div>

            <div id="dynamic_token_settings" style="display: none;">
                <div class="rewrite-extension_block flex-container">
                    <label for="dynamic_token_mode">Dynamic Token Mode:</label>
                    <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Multiplicative: Adjust tokens by percentage (e.g., 1.2 for 20% more). Additive: Adjust by adding/subtracting tokens (e.g., +50 or -20)."></span>
                    <select id="dynamic_token_mode" class="text_pole">
                        <option value="multiplicative">Multiplicative</option>
                        <option value="additive">Additive</option>
                    </select>
                </div>
                <div id="additive_settings">
                    <div class="rewrite-extension_block flex-container">
                        <label for="rewrite_tokens_add">Rewrite Tokens Difference:</label>
                        <input type="number" id="rewrite_tokens_add" class="text_pole" value="0">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="shorten_tokens_add">Shorten Tokens Difference:</label>
                        <input type="number" id="shorten_tokens_add" class="text_pole" value="-20">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="expand_tokens_add">Expand Tokens Difference:</label>
                        <input type="number" id="expand_tokens_add" class="text_pole" value="20">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="custom_tokens_add">Custom Tokens Difference:</label>
                        <input type="number" id="custom_tokens_add" class="text_pole" value="0">
                    </div>
                </div>
                <div id="multiplicative_settings">
                    <div class="rewrite-extension_block flex-container">
                        <label for="rewrite_tokens_mult">Rewrite Tokens Multiplier:</label>
                        <input type="number" id="rewrite_tokens_mult" class="text_pole" value="1.0" step="0.1">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="shorten_tokens_mult">Shorten Tokens Multiplier:</label>
                        <input type="number" id="shorten_tokens_mult" class="text_pole" value="0.8" step="0.1">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="expand_tokens_mult">Expand Tokens Multiplier:</label>
                        <input type="number" id="expand_tokens_mult" class="text_pole" value="1.2" step="0.1">
                    </div>
                    <div class="rewrite-extension_block flex-container">
                        <label for="custom_tokens_mult">Custom Tokens Multiplier:</label>
                        <input type="number" id="custom_tokens_mult" class="text_pole" value="1.0" step="0.1">
                    </div>
                </div>
            </div>

            <div class="rewrite-extension_block" style="margin-top: 15px;">
                <div class="flex-container">
                    <div style="width: 49%;">
                        <label for="remove_prefix">Remove Prefix:</label>
                        <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Text to remove from the beginning of the AI's response."></span>
                    </div>
                    <div style="width: 49%;">
                        <label for="remove_suffix">Remove Suffix:</label>
                        <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Text to remove from the end of the AI's response."></span>
                    </div>
                </div>
                <div class="flex-container" style="margin-top: 5px;">
                    <input type="text" id="remove_prefix" class="text_pole" style="width: 49%;" placeholder="Prefix to remove">
                    <input type="text" id="remove_suffix" class="text_pole" style="width: 49%;" placeholder="Suffix to remove">
                </div>
            </div>

            <div class="rewrite-extension_block flex-container">
                <label for="highlight_duration">Highlight Duration (ms):</label>
                <span class="tooltip-icon fa-solid fa-circle-question" data-tooltip="Duration in milliseconds for which the rewritten text will be highlighted."></span>
                <input type="number" id="highlight_duration" class="text_pole" min="0" step="100" value="3000">
            </div>

            <hr class="sysHR" />
            <div class="rewrite-extension_block flex-container">
                <div class="inline-drawer">
                    <div class="inline-drawer-toggle inline-drawer-header">
                        <b>Button visibility</b>
                        <div class="inline-drawer-icon fa-solid fa-circle-chevron-up up"></div>
                    </div>
                    <div class="inline-drawer-content" style="display: none;">
                        <div class="checkbox-container">
                            <input type="checkbox" id="show_rewrite" class="checkbox" checked>
                            <label for="show_rewrite">Show Rewrite</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="show_shorten" class="checkbox" checked>
                            <label for="show_shorten">Show Shorten</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="show_expand" class="checkbox" checked>
                            <label for="show_expand">Show Expand</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="show_custom" class="checkbox" checked>
                            <label for="show_custom">Show Custom</label>
                        </div>
                        <div class="checkbox-container">
                            <input type="checkbox" id="show_delete" class="checkbox" checked>
                            <label for="show_delete">Show Delete</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
